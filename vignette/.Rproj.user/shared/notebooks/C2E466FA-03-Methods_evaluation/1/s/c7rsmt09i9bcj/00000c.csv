"0","## extract the variance of trt and batch"
"0","# before"
"0","ad.varmat.before <- as.matrix(ad.varPart.before[ ,1:2])"
"0","# BMC"
"0","ad.varmat.bmc <- as.matrix(ad.varPart.bmc[ ,1:2])"
"0","# ComBat"
"0","ad.varmat.combat <- as.matrix(ad.varPart.combat[ ,1:2])"
"0","# removeBatchEffect"
"0","ad.varmat.limma <- as.matrix(ad.varPart.limma[ ,1:2])"
"0","# percentile normalisation"
"0","ad.varmat.percentile <- as.matrix(ad.varPart.percentile[ ,1:2])"
"0","# SVD"
"0","ad.varmat.svd <- as.matrix(ad.varPart.svd[ ,1:2])"
"0","# RUVIII"
"0","ad.varmat.ruv <- as.matrix(ad.varPart.ruv[ ,1:2])"
"0","## merge results"
"0","ad.variance <- c(as.vector(ad.varmat.before), as.vector(ad.varmat.bmc),"
"0","                 as.vector(ad.varmat.combat), as.vector(ad.varmat.limma),"
"0","                 as.vector(ad.varmat.percentile), as.vector(ad.varmat.svd), "
"0","                 as.vector(ad.varmat.ruv))"
"0","## add batch, trt and methods info"
"0","ad.variance <- cbind(variance = ad.variance, "
"0","                     Type = rep(c( 'Treatment', 'Batch'), each = ncol(ad.tss.clr)),"
"0","                     method = rep(c('Before', 'BMC', 'ComBat', 'rBE', 'PN', "
"0","                                    'SVD', 'RUVIII'), each = 2*ncol(ad.tss.clr)))"
"0","## reorder levels  "
"0","ad.variance <- as.data.frame(ad.variance)"
"0","ad.variance$method <- factor(ad.variance$method, "
"0","                            levels = unique(ad.variance$method))"
"0","ad.variance$variance <- as.numeric(as.character(ad.variance$variance))"
"0","ggplot(ad.variance, aes(x = Type, y = variance, fill = Type)) + "
"0","  geom_boxplot() + facet_grid(cols = vars(method)) + theme_bw() + "
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1), "
"0","        strip.text = element_text(size = 11), panel.grid = element_blank(), "
"0","        axis.text = element_text(size = 12), axis.title = element_text(size = 15),"
"0","        legend.title = element_text(size = 15), legend.text = element_text(size = 12)) + "
"0","  labs(x = ""Type"", y = ""Proportion Variance"", name = 'Type') + "
"0","  scale_fill_hue(l = 40) + ylim(0,1)"
