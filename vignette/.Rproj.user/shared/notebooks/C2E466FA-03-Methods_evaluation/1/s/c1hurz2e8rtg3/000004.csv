"0","##########"
"0","# AD data"
"0","form.ad <- ~ ad.trt + ad.batch"
"0","info.ad = as.data.frame(cbind(rownames(ad.tss.clr),ad.trt,ad.batch))"
"0","rownames(info.ad) = rownames(ad.tss.clr)"
"0","# before"
"0","varPart.ad.before <- fitExtractVarPartModel(t(ad.tss.clr), form.ad, info.ad)"
"0","# BMC"
"0","varPart.ad.bmc <- fitExtractVarPartModel(t(ad.bmc), form.ad, info.ad)"
"0","# combat"
"0","varPart.ad.combat <- fitExtractVarPartModel(t(ad.combat), form.ad, info.ad)"
"0","# removeBatchEffect"
"0","varPart.ad.limma <- fitExtractVarPartModel(t(ad.limma), form.ad, info.ad)"
"0","# percentile normalisation"
"0","varPart.ad.percentile <- fitExtractVarPartModel(t(ad.percentile), form.ad, info.ad)"
"0","# svd"
"0","varPart.ad.svd <- fitExtractVarPartModel(t(ad.svd), form.ad, info.ad)"
"0","# ruv"
"0","varPart.ad.ruv <- fitExtractVarPartModel(t(ad.ruvIII), form.ad, info.ad)"
"0","################"
"0","#merge them"
"0","variance.ad =  rbind(cbind(variance = varPart.ad.before$ad.batch,Type = rep('Batch',231), method = rep('Before',231)),"
"0","                             cbind(variance = varPart.ad.before$ad.trt,Type = rep('Treatment',231), method = rep('Before',231)),"
"0","                             cbind(variance = varPart.ad.bmc$ad.batch,Type = rep('Batch',231), method = rep('BMC',231)),"
"0","                             cbind(variance = varPart.ad.bmc$ad.trt,Type = rep('Treatment',231), method = rep('BMC',231)),"
"0","                             cbind(variance = varPart.ad.combat$ad.batch,Type = rep('Batch',231), method = rep('ComBat',231)),"
"0","                             cbind(variance = varPart.ad.combat$ad.trt,Type = rep('Treatment',231), method = rep('ComBat',231)),"
"0","                             cbind(variance = varPart.ad.limma$ad.batch,Type = rep('Batch',231), method = rep('rBE',231)),"
"0","                             cbind(variance = varPart.ad.limma$ad.trt,Type = rep('Treatment',231), method = rep('rBE',231)),"
"0","                             cbind(variance = varPart.ad.percentile$ad.batch,Type = rep('Batch',231), method = rep('PN',231)),"
"0","                             cbind(variance = varPart.ad.percentile$ad.trt,Type = rep('Treatment',231), method = rep('PN',231)),"
"0","                             cbind(variance = varPart.ad.svd$ad.batch,Type = rep('Batch',231), method = rep('SVD',231)),"
"0","                             cbind(variance = varPart.ad.svd$ad.trt,Type = rep('Treatment',231), method = rep('SVD',231)), cbind(variance = varPart.ad.ruv$ad.batch,Type = rep('Batch',231), method = rep('RUVIII',231)),"
"0","                             cbind(variance = varPart.ad.ruv$ad.trt,Type = rep('Treatment',231), method = rep('RUVIII',231)))"
"0","variance.ad = as.data.frame(variance.ad)"
"0","variance.ad$Type = factor(variance.ad$Type,levels = unique(variance.ad$Type))"
"0","variance.ad$method = factor(variance.ad$method,levels = unique(variance.ad$method))"
"0","variance.ad$variance = as.numeric(as.character(variance.ad$variance))"
"0","ggplot(variance.ad, aes(x=Type, y=variance,fill=Type)) + geom_boxplot() + facet_grid(cols = vars(method)) + theme_bw() + theme(axis.text.x = element_text(angle = 60, hjust = 1), strip.text = element_text(size=11),panel.grid = element_blank(),axis.text = element_text(size=12),axis.title = element_text(size=15),legend.title = element_text(size=15),legend.text = element_text(size=12)) + labs(x = ""Type"", y = ""Proportion Variance"",name='Type') + scale_fill_hue(l=40) + ylim(0,1)"
