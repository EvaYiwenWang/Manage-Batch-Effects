"0","## extract the variance of trt and batch"
"0","# before"
"0","sponge.varmat.before <- as.matrix(sponge.varPart.before[ ,1:2])"
"0","# BMC"
"0","sponge.varmat.bmc <- as.matrix(sponge.varPart.bmc[ ,1:2])"
"0","# ComBat"
"0","sponge.varmat.combat <- as.matrix(sponge.varPart.combat[ ,1:2])"
"0","# removeBatchEffect"
"0","sponge.varmat.limma <- as.matrix(sponge.varPart.limma[ ,1:2])"
"0","# percentile normalisation"
"0","sponge.varmat.percentile <- as.matrix(sponge.varPart.percentile[ ,1:2])"
"0","# SVD"
"0","sponge.varmat.svd <- as.matrix(sponge.varPart.svd[ ,1:2])"
"0","## merge results"
"0","sponge.variance <- c(as.vector(sponge.varmat.before), as.vector(sponge.varmat.bmc),"
"0","                     as.vector(sponge.varmat.combat), as.vector(sponge.varmat.limma),"
"0","                     as.vector(sponge.varmat.percentile), as.vector(sponge.varmat.svd))"
"0","## add batch, trt and methods info"
"0","sponge.variance <- cbind(variance = sponge.variance, "
"0","                         Type = rep(c('Tissue', 'Batch'), each = ncol(sponge.tss.clr)),"
"0","                         method = rep(c('Before', 'BMC', 'ComBat', 'rBE', "
"0","                                        'PN', 'SVD'), each = 2*ncol(sponge.tss.clr)))"
"0","## reorder levels  "
"0","sponge.variance <- as.data.frame(sponge.variance)"
"0","sponge.variance$method <- factor(sponge.variance$method, "
"0","                                levels = unique(sponge.variance$method))"
"0","sponge.variance$variance <- as.numeric(as.character(sponge.variance$variance))"
"0","ggplot(sponge.variance, aes(x = Type, y = variance, fill = Type)) + "
"0","  geom_boxplot() + facet_grid(cols = vars(method)) + theme_bw() + "
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1), "
"0","        strip.text = element_text(size = 12), panel.grid = element_blank(), "
"0","        axis.text = element_text(size = 12), axis.title = element_text(size = 15), "
"0","        legend.title = element_text(size = 15), legend.text = element_text(size = 12)) + "
"0","  labs(x = 'Type', y = 'Proportion Variance', name = 'Type') + ylim(0,1)"
