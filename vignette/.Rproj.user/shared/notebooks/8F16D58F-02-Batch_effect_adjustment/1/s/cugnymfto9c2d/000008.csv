"0","#####################"
"0","# ad data only"
"0","replicates.ad = ad.metadata$sample_name.data.extraction"
"0","replicates.ad.matrix = replicate.matrix(replicates.ad)"
"0","p.ad = matrix(NA,nrow = 2, ncol = ncol(ad.tss.clr))"
"0","rownames(p.ad) = c('ad.trt','ad.batch')"
"0","colnames(p.ad) = colnames(ad.tss.clr)"
"0","for(i in 1:ncol(ad.tss.clr)){"
"0","  res = lm(ad.tss.clr[,i] ~ ad.trt + ad.batch)"
"0","  summ.res = summary(res)"
"0","  anova.res = anova(res)"
"0","  p.ad[1,i] = anova.res$`Pr(>F)`[1]"
"0","  p.ad[2,i] = anova.res$`Pr(>F)`[2]"
"0","}"
"0","p.adj.ad = apply(p.ad,1,p.adjust,method = 'fdr')"
"0","p.adj.ad1 = sort(p.adj.ad[,1],decreasing = T)"
"0","nc.otu1 = names(p.adj.ad1[1:75]) #negative control genes need be equal or more than samples"
"0","nc1 = rep(FALSE, ncol(ad.tss.clr))"
"0","names(nc1) = colnames(ad.tss.clr)"
"0","nc1[nc.otu1] = TRUE"
"0","ad.ruv <- RUVIII(Y=ad.tss.clr,M = replicates.ad.matrix, ctl = nc1)"
"0","rownames(ad.ruv) = rownames(ad.tss.clr)"
