"0","# sponge data"
"0","sponge.sd <- apply(sponge.tss.clr, 2, sd) # calculate standard deviation"
"0","sponge.mean <- apply(sponge.tss.clr, 2, mean) # calculate mean"
"0","sponge.X <- scale(sponge.tss.clr, center = T, scale = T) # center and scale"
"0","sponge.m <- crossprod(sponge.X) # generate a square matrix"
"0","sponge.m.svd <- svd(sponge.m) # SVD "
"0","# barplot(sponge.m.svd$d)"
"0","# extract 1st singular vectors"
"0","sponge.a1 <- sponge.m.svd$u[ ,1] "
"0","sponge.b1 <- sponge.m.svd$v[ ,1]"
"0","# deflate component 1 from the data"
"0","sponge.t1 <- sponge.X %*% sponge.a1 / drop(sqrt(crossprod(sponge.a1)))"
"0","sponge.c1 <- crossprod(sponge.X, sponge.t1) / drop(crossprod(sponge.t1))"
"0","sponge.svd.defl.matrix1  <- sponge.X - sponge.t1 %*% t(sponge.c1)"
"0","## add back mean and standard deviation"
"0","sponge.svd <- sponge.svd.defl.matrix1"
"0","sponge.svd[1:nrow(sponge.svd), 1:ncol(sponge.svd)] = NA"
"0","for(i in 1:ncol(sponge.svd.defl.matrix1)){"
"0","  for(j in 1:nrow(sponge.svd.defl.matrix1)){"
"0","    sponge.svd[j,i] = sponge.svd.defl.matrix1[j,i]*sponge.sd[i] + sponge.mean[i]"
"0","  }"
"0","}"
