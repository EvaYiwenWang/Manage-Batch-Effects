"0","## Create the simulated data"
"0","m = 50"
"0","n = 10000"
"0","nc = 1000 #negative controls without treatment effects"
"0","p = 1"
"0","k = 1"
"0","ctl = rep(FALSE, n)"
"0","ctl[1:nc] = TRUE"
"0","# treatment effect"
"0","X = matrix(c(rep(0,floor(m/2)), rep(1,ceiling(m/2))), m, p)"
"0","beta = matrix(rnorm(p*n,5,1), p, n) #treatment coefficients"
"0","beta[,ctl] = 0"
"0","# batch effect"
"0","W = as.matrix(rep(0,m),m,k)"
"0","W[c(1:12,38:50),1] =  1"
"0","alpha2 = matrix(sample(c(rnorm(k*(3*n/4),0,1),rnorm(k*(n/4),5,1)),n),k,n)"
"0","Y_alpha2 = sapply(alpha2, function(alpha){rnorm(m, mean =  alpha, sd = abs(rnorm(1, mean = 0, sd = 2)) )})"
"0","YY_alpha2 = apply(Y_alpha2,2,function(x){x*W})"
"0","epsilon = matrix(rnorm(m*n,0,1),m,n)"
"0","Y2 = X%*%beta + YY_alpha2 + epsilon"
"0","w.cof2 = c()"
"0","for(i in 1:ncol(Y2)){"
"0","  res = lm(Y2[,i] ~ X + W)"
"0","  sum.res = summary(res)"
"0","  w.cof2[i] = sum.res$coefficients[3,1]"
"0","}"
"0","par(mfrow=c(2,2))"
"0","hist(w.cof2,col = 'gray')"
